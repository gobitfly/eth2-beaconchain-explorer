{{ define "addHandler" }}
  <script>
    const configurations = {{ . }}
    const bannerTemplate = `
        <div id="r-banner" class=" my-2 pb-1 ad d-flex justify-content-center align-items-center ad-banner">
            <div id="revive-banner" class="position-relative d-flex justify-content-center align-items-center" style="width:100%; height: 90px">
            <ins ref="ins" data-revive-zoneid="--bannerId--" data-revive-id="5b200397ccf8a9353bf44ef99b45268c"> </ins>
            </div>
        </div>
    `
    function refreshAd(id) {
      if (document.hasFocus()) {
        const ins = $(`#${id}`).find("ins")
        ins.removeAttr("data-revive-loaded")
        ins.removeAttr("data-revive-seq")
        reviveAsync["5b200397ccf8a9353bf44ef99b45268c"].refresh()
      }
    }

    function initiateConfig(config, retry = false) {
      const container = $(config.JQuerySelector)[0]
      if (container) {
        const htmlText = config.HtmlContent?.length ? config.HtmlContent : bannerTemplate.replace("--bannerId--", config.BannerId)
        const temp = document.createElement("div")
        temp.innerHTML = htmlText
        const ad = temp.firstElementChild
        ad.id = config.Id
        switch (config.InsertMode) {
          case "replace":
            container.replaceWith(ad)
            break
          case "before":
            container.before(ad)
            break
          case "after":
            container.after(ad)
            break
          default:
            container.append(ad)
            break
        }
        if (config.RefreshInterval) {
          window.requestInterval(() => refreshAd(config.Id), config.RefreshInterval * 1000)
        }
      } else if (retry) {
        setInterval(() => initiateConfig(config), 1000) //If we didn't find the element initially let's retry it once after one second.
      } else {
        console.log(`Ad component ${config.JQuerySelector} not found`)
      }
    }

    window.addEventListener("DOMContentLoaded", function () {
      configurations?.forEach(initiateConfig, true)
    })
  </script>
{{ end }}
